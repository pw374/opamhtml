<div class="ocaml_toplevel_module"><div class="info">A non-moving (in the gc sense) contiguous range of bytes, useful for I/O operations.<p>    An iobuf consists of:</p><p>    - bigstring</p><ul><li>limits -- a subrange of the bigstring</li><li>window -- a subrange of the limits</li></ul>    All iobuf operations are restricted to operate within the limits.  Initially, the
    window of an iobuf is identical to the limits.  A phantom type, &quot;seek&quot; permission,
    controls whether or not code is allowed to change the limits and window.  With seek
    permission, the limits can be <code class="code">narrow</code>ed, but can never be widened, and the window can
    be set to an arbitrary subrange of the limits.<p>    A phantom type controls whether code can read and write bytes in the bigstring (within
    the limits) or can only read them.</p><p>    To present a restricted view of an iobuf to a client, one can create a sub-iobuf or
    add a type constraint.</p></div>
<div class="ocaml_include sig" items="[]"><pre><span class="keyword">include</span> <code class="type"><code class="code">sig</code> .. <code class="code">end</code> with type <a href="?package=core&amp;module=Iobuf&amp;type=__pa_nonrec_0">__pa_nonrec_0</a> := <a href="?package=core&amp;module=Iobuf_intf&amp;type=seek">Iobuf_intf.seek</a></code></pre><div class="ocaml_module_content">
<pre><span class="TYPE__pa_nonrec_0"><span class="keyword">type</span> __pa_nonrec_0</span> = <code class="type"><a href="?package=core&amp;module=Iobuf_intf&amp;type=seek">Iobuf_intf.seek</a></code></pre>
<pre><span class="TYPEseek"><span class="keyword">type</span> seek</span> = <code class="type"><a href="?package=core&amp;module=Iobuf&amp;type=__pa_nonrec_0">__pa_nonrec_0</a></code></pre></div></div>
<div class="ocaml_include sig" items="[]"><pre><span class="keyword">include</span> <code class="type"><code class="code">sig</code> .. <code class="code">end</code> with type <a href="?package=core&amp;module=Iobuf&amp;type=__pa_nonrec_1">__pa_nonrec_1</a> := <a href="?package=core&amp;module=Iobuf_intf&amp;type=no_seek">Iobuf_intf.no_seek</a></code></pre><div class="ocaml_module_content">
<pre><span class="TYPE__pa_nonrec_1"><span class="keyword">type</span> __pa_nonrec_1</span> = <code class="type"><a href="?package=core&amp;module=Iobuf_intf&amp;type=no_seek">Iobuf_intf.no_seek</a></code></pre>
<pre><span class="TYPEno_seek"><span class="keyword">type</span> no_seek</span> = <code class="type"><a href="?package=core&amp;module=Iobuf&amp;type=__pa_nonrec_1">__pa_nonrec_1</a></code></pre></div></div>
<pre><span class="TYPEt"><span class="keyword">type</span> <code class="type">(+'data_perm_read_write, +'seek_permission) </code>t</span> </pre><div class="info"><div class="info">The first type parameter controls whether the iobuf can be written to.
    The second type parameter controls whether the window and limits can be changed.<p>    To allow <code class="code">read_write</code> or <code class="code">read_only</code> access, a function's type uses <code class="code">_</code> rather than
    <code class="code">read_only</code> as the type argument to <code class="code">t</code>.  Analogously, to allow <code class="code">no_seek</code> or <code class="code">seek</code>
    access, a function's type uses <code class="code">_</code> rather than <code class="code">no_seek</code> as the type argument to <code class="code">t</code>.
    Using <code class="code">_</code> allows the function to be directly applied to either permission.  Using
    a specific permission would require code to use coercion <code class="code">:&gt;</code>.</p></div></div>
<div class="ocaml_include ident" path="?package=core&amp;module=Invariant.S2" items="[]"><pre><span class="keyword">include</span> <code class="type"><code class="code"><a href="?package=core&amp;module=Invariant.S2">Invariant.S2</a></code> with type t := ('a, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a></code></pre></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Creation</h1></div></div>
<pre><span class="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">len:int -&gt; ('a, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a></code></pre><div class="info"><div class="info"><code class="code">create ~len</code> creates a new iobuf, backed by a bigstring of length <code class="code">len</code>,
    with the limits and window set to the entire bigstring.</div></div>
<pre><span class="VALof_bigstring"><span class="keyword">val</span> of_bigstring</span> : <code class="type">?pos:int -&gt; ?len:int -&gt; <a href="?package=core&amp;module=Bigstring&amp;type=t">Bigstring.t</a> -&gt; ('a, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a></code></pre><div class="info"><div class="info"><code class="code">of_bigstring bigstring ~pos ~len</code> returns an iobuf backed by <code class="code">bigstring</code>, with the
    window and limits specified starting at <code class="code">pos</code> and of length <code class="code">len</code>.</div></div>
<pre><span class="VALof_string"><span class="keyword">val</span> of_string</span> : <code class="type">string -&gt; ('a, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a></code></pre><div class="info"><div class="info"><code class="code">of_string s</code> returns a new iobuf whose contents are <code class="code">s</code>.</div></div>
<pre><span class="VALsub"><span class="keyword">val</span> sub</span> : <code class="type">?pos:int -&gt; ?len:int -&gt; ('d, 'a) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; ('d, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a></code></pre><div class="info"><div class="info"><code class="code">sub t ~pos ~len</code> returns a new iobuf with limits and window set to the subrange of
    <code class="code">t</code> specified by <code class="code">pos</code> and <code class="code">len</code>.  <code class="code">sub</code> preserves data permissions, but allows
    arbitrary seek permissions on the resulting iobuf.</div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Accessors</h1></div></div>
<pre><span class="VALcapacity"><span class="keyword">val</span> capacity</span> : <code class="type">('a, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; int</code></pre><div class="info"><div class="info"><code class="code">capacity t</code> returns the size of <code class="code">t</code>'s limits subrange.  The capacity of an iobuf can
    be reduced via <code class="code">narrow</code>.</div></div>
<pre><span class="VALlength"><span class="keyword">val</span> length</span> : <code class="type">('a, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; int</code></pre><div class="info"><div class="info"><code class="code">length t</code> returns the size of <code class="code">t</code>'s window.</div></div>
<pre><span class="VALis_empty"><span class="keyword">val</span> is_empty</span> : <code class="type">('a, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; bool</code></pre><div class="info"><div class="info"><code class="code">is_empty t</code> is <code class="code">length t = 0</code>.</div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Changing the limits</h1></div></div>
<pre><span class="VALnarrow"><span class="keyword">val</span> narrow</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">narrow t</code> sets <code class="code">t</code>'s limits to the current window.</div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Changing the window</h1></div></div>
<div class="info"><div class="info">One can call <code class="code">Lo_bound.window t</code> to get a snapshot of the lower bound of the
    window, and then later restore that snapshot with <code class="code">Lo_bound.restore</code>.  This is
    useful for speculatively parsing, and then rewinding when there isn't enough data to
    finish.<p>    Similarly for <code class="code">Hi_bound.window</code> and <code class="code">Lo_bound.restore</code>.</p><p>    Using a snapshot with a different iobuf, even a sub iobuf of the snapshotted one, has
    unspecified results.  An exception may be raised, or a silent error may occur.
    However, the safety guarantees of the iobuf will not be violated, i.e., the attempt
    will not enlarge the limits of the subject iobuf.</p></div></div>
<div class="ocaml_module ident" name="Bound" path="?package=core&amp;module=Iobuf_intf.Bound"><pre><span class="keyword">module type</span> <a href="?package=core&amp;module=Iobuf.Bound">Bound</a> = <code class="type"><code class="code"><a href="?package=core&amp;module=Iobuf_intf.Bound">Iobuf_intf.Bound</a></code> with type iobuf := ('d, 'w) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a></code></pre></div>
<div class="ocaml_module ident" name="Lo_bound" path="?package=core&amp;module=Iobuf.Bound"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Lo_bound">Lo_bound</a> : <code class="type"><code class="code"><a href="?package=core&amp;module=Iobuf.Bound">Bound</a></code></code></pre></div>
<div class="ocaml_module ident" name="Hi_bound" path="?package=core&amp;module=Iobuf.Bound"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Hi_bound">Hi_bound</a> : <code class="type"><code class="code"><a href="?package=core&amp;module=Iobuf.Bound">Bound</a></code></code></pre></div>
<pre><span class="VALadvance"><span class="keyword">val</span> advance</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; int -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">advance t amount</code> advances the lower bound of the window by <code class="code">amount</code>.  It is an error
    to advance past the upper bound of the window or the lower limit.</div></div>
<pre><span class="VALresize"><span class="keyword">val</span> resize</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; len:int -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">resize t</code> sets the length of <code class="code">t</code>'s window, provided it does not exceed limits.</div></div>
<pre><span class="VALrewind"><span class="keyword">val</span> rewind</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">rewind t</code> sets the lower bound of the window to the lower limit.</div></div>
<pre><span class="VALreset"><span class="keyword">val</span> reset</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">reset t</code> sets the window to the limits.</div></div>
<pre><span class="VALflip_lo"><span class="keyword">val</span> flip_lo</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">flip_lo t</code> sets the window to range from the lower limit to the lower bound of the
    old window.  This is typically called after a series of <code class="code">Fill</code>s, to reposition the
    window in preparation to <code class="code">Consume</code> the newly written data.<p>    The bounded version narrows the effective limit.  This can preserve some data near the
    limit, such as an hypothetical packet header, in the case of <code class="code">bounded_flip_lo</code> or
    unfilled suffix of a buffer, in <code class="code">bounded_flip_hi</code>.</p></div></div>
<pre><span class="VALbounded_flip_lo"><span class="keyword">val</span> bounded_flip_lo</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=core&amp;module=Iobuf.Lo_bound&amp;type=t">Lo_bound.t</a> -&gt; unit</code></pre>
<pre><span class="VALcompact"><span class="keyword">val</span> compact</span> : <code class="type">(<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">compact t</code> copies data from the window to the lower limit of the iobuf and sets the
    window to range from the end of the copied data to the upper limit.  This is typically
    called after a series of <code class="code">Consume</code>s to save unread data and prepare for the next
    series of <code class="code">Fill</code>s and <code class="code">flip_lo</code>.</div></div>
<pre><span class="VALbounded_compact"><span class="keyword">val</span> bounded_compact</span> : <code class="type">(<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=core&amp;module=Iobuf.Lo_bound&amp;type=t">Lo_bound.t</a> -&gt; <a href="?package=core&amp;module=Iobuf.Hi_bound&amp;type=t">Hi_bound.t</a> -&gt; unit</code></pre>
<pre><span class="VALflip_hi"><span class="keyword">val</span> flip_hi</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">flip_hi t</code> sets the window to range from the the upper bound of the current window to
    the upper limit.  This operation is dual to <code class="code">flip_lo</code> and is typically called when the
    data in the current (narrowed) window has been processed and the window needs to be
    positioned over the remaining data in the buffer.  For example:<p>    </p><code class="code">
      (* ... determine initial_data_len ... *)
      Iobuf.resize buf ~len:initial_data_len;
      (* ... and process initial data ... *)
      Iobuf.flip_hi buf;
    </code><p>    Now the window of <code class="code">buf</code> ranges over the remainder of the data.</p></div></div>
<pre><span class="VALbounded_flip_hi"><span class="keyword">val</span> bounded_flip_hi</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=core&amp;module=Iobuf.Hi_bound&amp;type=t">Hi_bound.t</a> -&gt; unit</code></pre>
<div class="info"><div class="info"><h1 id="1_TITLE">Getting and setting data</h1></div></div>
<div class="info"><div class="info">&quot;consume&quot; and &quot;fill&quot; functions access data at the lower bound of the window and
    advance lower bound of the window.  &quot;peek&quot; and &quot;poke&quot; functions access data but do not
    advance the window.</div></div>
<pre><span class="VALto_string"><span class="keyword">val</span> to_string</span> : <code class="type">?len:int -&gt; ('a, 'b) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; string</code></pre><div class="info"><div class="info"><code class="code">to_string t</code> returns the bytes in <code class="code">t</code> as a string.  It does not alter the window.</div></div>
<pre><span class="VALconsume_into_string"><span class="keyword">val</span> consume_into_string</span> : <code class="type">?pos:int -&gt; ?len:int -&gt; ('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; string -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">consume_into_string t s ~pos ~len</code> reads <code class="code">len</code> bytes from <code class="code">t</code>, advancing <code class="code">t</code>'s window
    accordingly, and writes them into <code class="code">s</code> starting at <code class="code">pos</code>.  By default <code class="code">pos = 0</code> and
    <code class="code">len = String.length s - pos</code>.  It is an error if <code class="code">pos</code> and <code class="code">len</code> don't specify a
    valid region of <code class="code">s</code> or <code class="code">len &gt; length t</code>.</div></div>
<pre><span class="VALconsume_into_bigstring"><span class="keyword">val</span> consume_into_bigstring</span> : <code class="type">?pos:int -&gt; ?len:int -&gt; ('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=core&amp;module=Bigstring&amp;type=t">Bigstring.t</a> -&gt; unit</code></pre>
<div class="ocaml_module ident" name="Consume" path="?package=core&amp;module=Iobuf_intf.Accessors"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Consume">Consume</a> : <code class="type"><code class="code"><a href="?package=core&amp;module=Iobuf_intf.Accessors">Iobuf_intf.Accessors</a></code> with type t = ('d, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; 'a</code></pre><div class="info"><div class="info"><code class="code">Consume.string t ~len</code> reads <code class="code">len</code> characters (all, by default) from <code class="code">t</code> into a new
    string and advances the lower bound of the window accordingly.</div></div></div>
<div class="ocaml_module ident" name="Fill" path="?package=core&amp;module=Iobuf_intf.Accessors"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Fill">Fill</a> : <code class="type"><code class="code"><a href="?package=core&amp;module=Iobuf_intf.Accessors">Iobuf_intf.Accessors</a></code> with type t = (<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; 'a -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">Peek</code> and <code class="code">Poke</code> functions access a value at <code class="code">pos</code> from the lower bound of the window
    and do not advance.</div></div></div>
<div class="ocaml_module ident" name="Peek" path="?package=core&amp;module=Iobuf_intf.Accessors"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Peek">Peek</a> : <code class="type"><code class="code"><a href="?package=core&amp;module=Iobuf_intf.Accessors">Iobuf_intf.Accessors</a></code> with type t = ('d, 'w) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; pos:int -&gt; 'a</code></pre></div>
<div class="ocaml_module ident" name="Poke" path="?package=core&amp;module=Iobuf_intf.Accessors"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Poke">Poke</a> : <code class="type"><code class="code"><a href="?package=core&amp;module=Iobuf_intf.Accessors">Iobuf_intf.Accessors</a></code> with type t = (<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, 'w) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; pos:int -&gt; 'a -&gt; unit</code></pre></div>
<div class="ocaml_module sig" name="Unsafe"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Unsafe">Unsafe</a> : <code class="type"><code class="code">sig</code> .. <code class="code">end</code></code></pre><div class="info"><div class="info"><code class="code">Unsafe</code> has submodules that are like their corresponding module, except with no range
    checks.  Hence, mistaken uses can cause segfaults.  Be careful!</div></div><div class="ocaml_module_content">
<div class="ocaml_module ident" name="Consume" path="?package=core&amp;module=Iobuf.Consume"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Unsafe.Consume">Consume</a> : <code class="type">module type of <code class="code"><a href="?package=core&amp;module=Iobuf.Consume">Consume</a></code></code></pre></div>
<div class="ocaml_module ident" name="Fill" path="?package=core&amp;module=Iobuf.Fill"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Unsafe.Fill">Fill</a> : <code class="type">module type of <code class="code"><a href="?package=core&amp;module=Iobuf.Fill">Fill</a></code></code></pre></div>
<div class="ocaml_module ident" name="Peek" path="?package=core&amp;module=Iobuf.Peek"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Unsafe.Peek">Peek</a> : <code class="type">module type of <code class="code"><a href="?package=core&amp;module=Iobuf.Peek">Peek</a></code></code></pre></div>
<div class="ocaml_module ident" name="Poke" path="?package=core&amp;module=Iobuf.Poke"><pre><span class="keyword">module</span> <a href="?package=core&amp;module=Iobuf.Unsafe.Poke">Poke</a> : <code class="type">module type of <code class="code"><a href="?package=core&amp;module=Iobuf.Poke">Poke</a></code></code></pre></div></div></div>
<pre><span class="VALfill_bin_prot"><span class="keyword">val</span> fill_bin_prot</span> : <code class="type">(<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt;
'a <a href="?package=bin_prot&amp;module=Type_class&amp;type=writer">Bin_prot.Type_class.writer</a> -&gt; 'a -&gt; unit <a href="?package=core&amp;module=Or_error&amp;type=t">Or_error.t</a></code></pre><div class="info"><div class="info"><code class="code">fill_bin_prot</code> writes a bin-prot value to the lower bound of the window, prefixed by
    its length, and advances by the amount written.  <code class="code">fill_bin_prot</code> returns an error if
    the window is too small to write the value.<p>    <code class="code">consume_bin_prot t reader</code> reads a bin-prot value from the lower bound of the window,
    which should have been written using <code class="code">fill_bin_prot</code>, and advances the window by the
    amount read.  <code class="code">consume_bin_prot</code> returns an error if there is not a complete message
    in the window and in that case the window is left unchanged.</p></div></div>
<pre><span class="VALconsume_bin_prot"><span class="keyword">val</span> consume_bin_prot</span> : <code class="type">('b, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; 'a <a href="?package=bin_prot&amp;module=Type_class&amp;type=reader">Bin_prot.Type_class.reader</a> -&gt; 'a <a href="?package=core&amp;module=Or_error&amp;type=t">Or_error.t</a></code></pre>
<pre><span class="VALtransfer"><span class="keyword">val</span> transfer</span> : <code class="type">?len:int -&gt; src:('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; dst:(<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">transfer</code> blits <code class="code">len</code> bytes from <code class="code">src</code> to <code class="code">dst</code>, advancing the lower bounds of both
    windows.  It is an error if <code class="code">len &gt; length src || len &gt; length dst || phys_equal src
    dst</code>.</div></div>
<pre><span class="VALmemmove"><span class="keyword">val</span> memmove</span> : <code class="type">(<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, 'a) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; src_pos:int -&gt; dst_pos:int -&gt; len:int -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">memmove</code> blits <code class="code">len</code> bytes from <code class="code">src_pos</code> to <code class="code">dst_pos</code> in an iobuf, both relative to
    the lower bound of the window.  The window is not advanced.</div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">I/O</h1></div></div>
<pre><span class="VALread_assume_fd_is_nonblocking"><span class="keyword">val</span> read_assume_fd_is_nonblocking</span> : <code class="type">(<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=core&amp;module=Iobuf_intf.Unix.File_descr&amp;type=t">Iobuf_intf.Unix.File_descr.t</a> -&gt; int</code></pre><div class="info"><div class="info"><code class="code">Iobuf</code> has analogs of various <code class="code">Bigstring</code> functions.  These analogs advance by the
    amount written/read.</div></div>
<pre><span class="VALpread_assume_fd_is_nonblocking"><span class="keyword">val</span> pread_assume_fd_is_nonblocking</span> : <code class="type">(<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt;
<a href="?package=core&amp;module=Iobuf_intf.Unix.File_descr&amp;type=t">Iobuf_intf.Unix.File_descr.t</a> -&gt; offset:int -&gt; int</code></pre>
<pre><span class="VALrecvfrom_assume_fd_is_nonblocking"><span class="keyword">val</span> recvfrom_assume_fd_is_nonblocking</span> : <code class="type">(<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt;
<a href="?package=core&amp;module=Iobuf_intf.Unix.File_descr&amp;type=t">Iobuf_intf.Unix.File_descr.t</a> -&gt; int * <a href="?package=core&amp;module=Iobuf_intf.Unix&amp;type=sockaddr">Iobuf_intf.Unix.sockaddr</a></code></pre>
<pre><span class="VALrecvmmsg_assume_fd_is_nonblocking"><span class="keyword">val</span> recvmmsg_assume_fd_is_nonblocking</span> : <code class="type">(<a href="?package=core&amp;module=Iobuf_intf.Unix.File_descr&amp;type=t">Iobuf_intf.Unix.File_descr.t</a> -&gt;
 ?count:int -&gt;
 ?srcs:<a href="?package=core&amp;module=Iobuf_intf.Unix&amp;type=sockaddr">Iobuf_intf.Unix.sockaddr</a> array -&gt;
 (<a href="?package=core&amp;module=Common&amp;type=read_write">Common.read_write</a>, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> array -&gt; int)
<a href="?package=core&amp;module=Or_error&amp;type=t">Or_error.t</a></code></pre>
<pre><span class="VALsend_nonblocking_no_sigpipe"><span class="keyword">val</span> send_nonblocking_no_sigpipe</span> : <code class="type">unit -&gt;
(('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=core&amp;module=Iobuf_intf.Unix.File_descr&amp;type=t">Iobuf_intf.Unix.File_descr.t</a> -&gt; int option) <a href="?package=core&amp;module=Or_error&amp;type=t">Or_error.t</a></code></pre>
<pre><span class="VALsendto_nonblocking_no_sigpipe"><span class="keyword">val</span> sendto_nonblocking_no_sigpipe</span> : <code class="type">unit -&gt;
(('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt;
 <a href="?package=core&amp;module=Iobuf_intf.Unix.File_descr&amp;type=t">Iobuf_intf.Unix.File_descr.t</a> -&gt; <a href="?package=core&amp;module=Iobuf_intf.Unix&amp;type=sockaddr">Iobuf_intf.Unix.sockaddr</a> -&gt; int option)
<a href="?package=core&amp;module=Or_error&amp;type=t">Or_error.t</a></code></pre>
<pre><span class="VALwrite_assume_fd_is_nonblocking"><span class="keyword">val</span> write_assume_fd_is_nonblocking</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=core&amp;module=Iobuf_intf.Unix.File_descr&amp;type=t">Iobuf_intf.Unix.File_descr.t</a> -&gt; int</code></pre>
<pre><span class="VALpwrite_assume_fd_is_nonblocking"><span class="keyword">val</span> pwrite_assume_fd_is_nonblocking</span> : <code class="type">('a, <a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a>) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=core&amp;module=Iobuf_intf.Unix.File_descr&amp;type=t">Iobuf_intf.Unix.File_descr.t</a> -&gt; offset:int -&gt; int</code></pre>
<pre><span class="VALsexp_of_seek"><span class="keyword">val</span> sexp_of_seek</span> : <code class="type"><a href="?package=core&amp;module=Iobuf&amp;type=seek">seek</a> -&gt; <a href="?package=sexplib&amp;module=Sexp&amp;type=t">Sexplib.Sexp.t</a></code></pre>
<pre><span class="VALsexp_of_no_seek"><span class="keyword">val</span> sexp_of_no_seek</span> : <code class="type"><a href="?package=core&amp;module=Iobuf&amp;type=no_seek">no_seek</a> -&gt; <a href="?package=sexplib&amp;module=Sexp&amp;type=t">Sexplib.Sexp.t</a></code></pre>
<pre><span class="VALsexp_of_t"><span class="keyword">val</span> sexp_of_t</span> : <code class="type">('data_perm_read_write -&gt; <a href="?package=sexplib&amp;module=Sexp&amp;type=t">Sexplib.Sexp.t</a>) -&gt;
('seek_permission -&gt; <a href="?package=sexplib&amp;module=Sexp&amp;type=t">Sexplib.Sexp.t</a>) -&gt;
('data_perm_read_write, 'seek_permission) <a href="?package=core&amp;module=Iobuf&amp;type=t">t</a> -&gt; <a href="?package=sexplib&amp;module=Sexp&amp;type=t">Sexplib.Sexp.t</a></code></pre><div class="info"><div class="info">The first type parameter controls whether the iobuf can be written to.
    The second type parameter controls whether the window and limits can be changed.<p>    To allow <code class="code">read_write</code> or <code class="code">read_only</code> access, a function's type uses <code class="code">_</code> rather than
    <code class="code">read_only</code> as the type argument to <code class="code">t</code>.  Analogously, to allow <code class="code">no_seek</code> or <code class="code">seek</code>
    access, a function's type uses <code class="code">_</code> rather than <code class="code">no_seek</code> as the type argument to <code class="code">t</code>.
    Using <code class="code">_</code> allows the function to be directly applied to either permission.  Using
    a specific permission would require code to use coercion <code class="code">:&gt;</code>.</p></div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Creation</h1></div></div>
<div class="info"><div class="info"><code class="code">create ~len</code> creates a new iobuf, backed by a bigstring of length <code class="code">len</code>,
    with the limits and window set to the entire bigstring.</div></div>
<div class="info"><div class="info"><code class="code">of_bigstring bigstring ~pos ~len</code> returns an iobuf backed by <code class="code">bigstring</code>, with the
    window and limits specified starting at <code class="code">pos</code> and of length <code class="code">len</code>.</div></div>
<div class="info"><div class="info">default is <code class="code">0</code></div></div>
<div class="info"><div class="info">default is <code class="code">Bigstring.length bigstring - pos</code></div></div>
<div class="info"><div class="info"><code class="code">of_string s</code> returns a new iobuf whose contents are <code class="code">s</code>.</div></div>
<div class="info"><div class="info"><code class="code">sub t ~pos ~len</code> returns a new iobuf with limits and window set to the subrange of
    <code class="code">t</code> specified by <code class="code">pos</code> and <code class="code">len</code>.  <code class="code">sub</code> preserves data permissions, but allows
    arbitrary seek permissions on the resulting iobuf.</div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Accessors</h1></div></div>
<div class="info"><div class="info"><code class="code">capacity t</code> returns the size of <code class="code">t</code>'s limits subrange.  The capacity of an iobuf can
    be reduced via <code class="code">narrow</code>.</div></div>
<div class="info"><div class="info"><code class="code">length t</code> returns the size of <code class="code">t</code>'s window.</div></div>
<div class="info"><div class="info"><code class="code">is_empty t</code> is <code class="code">length t = 0</code>.</div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Changing the limits</h1></div></div>
<div class="info"><div class="info"><code class="code">narrow t</code> sets <code class="code">t</code>'s limits to the current window.</div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Changing the window</h1></div></div>
<div class="info"><div class="info">One can call <code class="code">Lo_bound.window t</code> to get a snapshot of the lower bound of the
    window, and then later restore that snapshot with <code class="code">Lo_bound.restore</code>.  This is
    useful for speculatively parsing, and then rewinding when there isn't enough data to
    finish.<p>    Similarly for <code class="code">Hi_bound.window</code> and <code class="code">Lo_bound.restore</code>.</p><p>    Using a snapshot with a different iobuf, even a sub iobuf of the snapshotted one, has
    unspecified results.  An exception may be raised, or a silent error may occur.
    However, the safety guarantees of the iobuf will not be violated, i.e., the attempt
    will not enlarge the limits of the subject iobuf.</p></div></div>
<div class="info"><div class="info"><code class="code">advance t amount</code> advances the lower bound of the window by <code class="code">amount</code>.  It is an error
    to advance past the upper bound of the window or the lower limit.</div></div>
<div class="info"><div class="info"><code class="code">resize t</code> sets the length of <code class="code">t</code>'s window, provided it does not exceed limits.</div></div>
<div class="info"><div class="info"><code class="code">rewind t</code> sets the lower bound of the window to the lower limit.</div></div>
<div class="info"><div class="info"><code class="code">reset t</code> sets the window to the limits.</div></div>
<div class="info"><div class="info"><code class="code">flip_lo t</code> sets the window to range from the lower limit to the lower bound of the
    old window.  This is typically called after a series of <code class="code">Fill</code>s, to reposition the
    window in preparation to <code class="code">Consume</code> the newly written data.<p>    The bounded version narrows the effective limit.  This can preserve some data near the
    limit, such as an hypothetical packet header, in the case of <code class="code">bounded_flip_lo</code> or
    unfilled suffix of a buffer, in <code class="code">bounded_flip_hi</code>.</p></div></div>
<div class="info"><div class="info"><code class="code">compact t</code> copies data from the window to the lower limit of the iobuf and sets the
    window to range from the end of the copied data to the upper limit.  This is typically
    called after a series of <code class="code">Consume</code>s to save unread data and prepare for the next
    series of <code class="code">Fill</code>s and <code class="code">flip_lo</code>.</div></div>
<div class="info"><div class="info"><code class="code">flip_hi t</code> sets the window to range from the the upper bound of the current window to
    the upper limit.  This operation is dual to <code class="code">flip_lo</code> and is typically called when the
    data in the current (narrowed) window has been processed and the window needs to be
    positioned over the remaining data in the buffer.  For example:<p>    </p><code class="code">
      (* ... determine initial_data_len ... *)
      Iobuf.resize buf ~len:initial_data_len;
      (* ... and process initial data ... *)
      Iobuf.flip_hi buf;
    </code><p>    Now the window of <code class="code">buf</code> ranges over the remainder of the data.</p></div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">Getting and setting data</h1></div></div>
<div class="info"><div class="info">&quot;consume&quot; and &quot;fill&quot; functions access data at the lower bound of the window and
    advance lower bound of the window.  &quot;peek&quot; and &quot;poke&quot; functions access data but do not
    advance the window.</div></div>
<div class="info"><div class="info"><code class="code">to_string t</code> returns the bytes in <code class="code">t</code> as a string.  It does not alter the window.</div></div>
<div class="info"><div class="info"><code class="code">consume_into_string t s ~pos ~len</code> reads <code class="code">len</code> bytes from <code class="code">t</code>, advancing <code class="code">t</code>'s window
    accordingly, and writes them into <code class="code">s</code> starting at <code class="code">pos</code>.  By default <code class="code">pos = 0</code> and
    <code class="code">len = String.length s - pos</code>.  It is an error if <code class="code">pos</code> and <code class="code">len</code> don't specify a
    valid region of <code class="code">s</code> or <code class="code">len &gt; length t</code>.</div></div>
<div class="info"><div class="info"><code class="code">Consume.string t ~len</code> reads <code class="code">len</code> characters (all, by default) from <code class="code">t</code> into a new
    string and advances the lower bound of the window accordingly.</div></div>
<div class="info"><div class="info"><code class="code">Peek</code> and <code class="code">Poke</code> functions access a value at <code class="code">pos</code> from the lower bound of the window
    and do not advance.</div></div>
<div class="info"><div class="info"><code class="code">Unsafe</code> has submodules that are like their corresponding module, except with no range
    checks.  Hence, mistaken uses can cause segfaults.  Be careful!</div></div>
<div class="info"><div class="info"><code class="code">fill_bin_prot</code> writes a bin-prot value to the lower bound of the window, prefixed by
    its length, and advances by the amount written.  <code class="code">fill_bin_prot</code> returns an error if
    the window is too small to write the value.<p>    <code class="code">consume_bin_prot t reader</code> reads a bin-prot value from the lower bound of the window,
    which should have been written using <code class="code">fill_bin_prot</code>, and advances the window by the
    amount read.  <code class="code">consume_bin_prot</code> returns an error if there is not a complete message
    in the window and in that case the window is left unchanged.</p></div></div>
<div class="info"><div class="info"><code class="code">transfer</code> blits <code class="code">len</code> bytes from <code class="code">src</code> to <code class="code">dst</code>, advancing the lower bounds of both
    windows.  It is an error if <code class="code">len &gt; length src || len &gt; length dst || phys_equal src
    dst</code>.</div></div>
<div class="info"><div class="info">default is <code class="code">min (length src) (length dst)</code></div></div>
<div class="info"><div class="info"><code class="code">memmove</code> blits <code class="code">len</code> bytes from <code class="code">src_pos</code> to <code class="code">dst_pos</code> in an iobuf, both relative to
    the lower bound of the window.  The window is not advanced.</div></div>
<div class="info"><div class="info"><h1 id="1_TITLE">I/O</h1></div></div>
<div class="info"><div class="info"><code class="code">Iobuf</code> has analogs of various <code class="code">Bigstring</code> functions.  These analogs advance by the
    amount written/read.</div></div>
</div>